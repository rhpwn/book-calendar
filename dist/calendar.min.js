var BookCalendar=function(a){return this.locale=a.locale?a.locale:"en",this.daysCount=a.daysCount?a.daysCount:7,this.el=a.el,this.data=a.data,this.moveOnExisting=a.moveOnExisting,this.step=a.step?a.step:1,this.startDate=a.startDate?a.startDate:new Date,this.minDate=a.minDate?a.minDate:new Date,this.onMoveLeft=a.onMoveLeft?a.onMoveLeft:function(a){a()},this.onMoveRight=a.onMoveRight?a.onMoveRight:function(a){a()},this.cellPercentsWidth=(100/this.daysCount).toFixed(2),this.getLocale=function(){return this.language&&this.language.locale==this.locale||(this.language={locale:"en",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan.","Feb.","Mar.","Apr.","May","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."],weekdays:["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],weekdaysShort:["Sun","Sat","Fri","Thu","Wed","Tue","Mon"]}),this.language},this.getStartDate=function(){return new Date(this.startDate)},this.getEndDate=function(){var a=new Date(this.startDate);return a.setDate(a.getDate()+this.daysCount-1),new Date(a)},this.init=function(){var a='<div class="book-calendar-wrapper"><table width="100%" class="book-calendar-main-container"> <tr> <td> <table class="book-calendar-header"> <thead> <tr class="book-calendar-months"><a href="#" class="nav-arrow book-calendar-prev"></a><a href="#" class="nav-arrow book-calendar-next"></a></tr><tr class="book-calendar-days"> </tr></thead> </table> </td></tr><tr> <td> <div class="book-calendar-data-container"> <table width="100%"> <tbody class="book-calendar-data"> </tbody> </table> </div></td></tr></table></div>',b=document.getElementById(this.el);b.innerHTML=a,this.draw()},this.getKeyElements=function(){var a=document.getElementById(this.el);return{element:this.el,container:a,calendarWrapper:a.getElementsByClassName("book-calendar-wrapper")[0],dataContainer:a.getElementsByClassName("book-calendar-data")[0],monthsContainer:a.getElementsByClassName("book-calendar-months")[0],daysContainer:a.getElementsByClassName("book-calendar-days")[0],nextButton:a.getElementsByClassName("book-calendar-next")[0],prevButton:a.getElementsByClassName("book-calendar-prev")[0],activeCells:a.getElementsByClassName("book-calendar-cell-active"+this.el)}},this.groupHoursByDay=function(a){var b=a.reduce(function(a,b){var c=new Date(b);c.setHours(0,0,0,0);var d=c.toString();return a[0].hasOwnProperty(d)||(a[0][d]=[]),a[0][d].push(b),a},[{}]).reduce(function(a,b){return Object.keys(b).forEach(function(c){a.push({day:c,times:b[c]})}),a},[]);return b},this.getHoursByDate=function(a){a.setHours(0,0,0,0);var b=this.groupHoursByDay(this.data);for(var c in b){var d=new Date(b[c].day);if(d.getTime()==a.getTime())return b[c].times.sort()}return[]},this.moveExistingLeft=function(){var a=new Date(this.startDate);a.setHours(0,0,0,0);var b=this.data,c=[];for(var d in b){var e=new Date(b[d]).setHours(0,0,0,0);e.getTime()<a.getTime()&&c.push(e)}c.sort(),c.length>0&&(this.startDate=c.pop()),this.draw(),this.onMoveLeft(function(){})},this.moveExistingRight=function(){var a=new Date(this.startDate);a.setHours(0,0,0,0);var b=this.data,c=[];for(var d in b){var e=new Date(b[d]).setHours(0,0,0,0);e.getTime()>a.getTime()&&c.push(e)}c.sort(),c.length>0&&(this.startDate=c[0]),this.draw(),this.onMoveRight(function(){})},this.moveLeft=function(a){var b=a?a:this.step;this.startDate.setDate(this.startDate.getDate()-parseInt(b)),this.draw(),this.onMoveLeft(function(){})},this.moveRight=function(a){var b=a?a:this.step;this.startDate.setDate(this.startDate.getDate()+parseInt(b)),this.draw(),this.onMoveRight(function(){})},this.prevDisabled=function(a){var b=this.getKeyElements();b.prevButton.disabled=a},this.getDisplayDates=function(){for(var a=new Date(this.startDate),b=[],c=0;c<this.daysCount;c++){var d=new Date(a);b.push(d),a.setDate(a.getDate()+1)}return b},this.getMonth=function(a){return{"long":this.getLocale().months[a].charAt(0).toUpperCase()+this.getLocale().months[a].slice(1),"short":this.getLocale().monthsShort[a].charAt(0).toUpperCase()+this.getLocale().monthsShort[a].slice(1)}},this.getDay=function(a){return{"long":this.getLocale().weekdays[a],"short":this.getLocale().weekdaysShort[a]}},this.getMaxInputs=function(){var a=0,b=this.groupHoursByDay(this.data);for(var c in b)b[c].times.length>a&&(a=b[c].times.length);return a},this.getHead=function(){var a=this.startDate.getMonth(),b=this.getDisplayDates(),c={first:0,second:0};c.firstMonth=this.getMonth(a)["short"]+" "+this.startDate.getFullYear();for(var d in b)if(b[d].getMonth()==a)c.first++,c.lastMonth=this.getMonth(a)["short"]+" "+b[d].getFullYear();else{c.second++;var e=a;e>11&&(e=0);var f=e+1;12==f&&(f=0),c.lastMonth=this.getMonth(f)["short"]+" "+b[d].getFullYear()}return c},this.addListeners=function(){for(var a=this,b=this.getKeyElements(),c=document.getElementsByClassName("book-calendar-cell-active-"+a.el),d=function(){for(var b=0;b<c.length;b++)c[b].className="book-calendar-cell-active book-calendar-cell-active-"+a.el;this.className=this.className+" book-calendar-cell-active-selected",a.selectedDate=new Date(this.dataset.date),a.onSelect(a.selectedDate)},e=0;e<c.length;e++)c[e].addEventListener("click",d,!1);a=this,b.prevButton.onclick=function(){a.moveOnExisting?a.moveExistingLeft():a.moveLeft()},b.nextButton.onclick=function(){a.moveOnExisting?a.moveExistingRight():a.moveRight()}},this.onSelect=a.onSelect?a.onSelect:function(a){return a},this.afterDraw=a.afterDraw?a.afterDraw:function(a){a()},this.draw=function(){var a=this.getKeyElements();if(a.dataContainer&&a.monthsContainer&&a.daysContainer&&a.nextButton&&a.prevButton){var b=this.getDisplayDates(),c=this.getHead(),d="",e="";for(var f in b){var g=new Date(b[f]);g.setDate(g.getDate()+1),e=b[f].getMonth()!=g.getMonth()?"book-calendar-cell-last":"",d+='<td  style="width: '+this.cellPercentsWidth+'%" class="book-calendar-day '+e+'">'+(b[f].getDate()<10?"0":"")+b[f].getDate()+'<br><span class="book-calendar-day-name">'+this.getDay(b[f].getDay())["short"]+"</span></td>"}var h="";c.first>0&&(h+='<th colspan="'+c.first+'"> '+c.firstMonth+" </th>"),c.second>0&&(h+='<th colspan="'+c.second+'"> '+c.lastMonth+" </th>"),a.daysContainer.innerHTML=d,a.monthsContainer.innerHTML=h;var i="",j=this.getDisplayDates(),k=this.daysCount-1;for(f=0;f<this.getMaxInputs();f++){i+="<tr>";for(var l=0;k>=l;l++){var m=this.getHoursByDate(j[l]),n="",o=new Date(m[f]),p=o.getHours()+"<sup>"+(o.getMinutes()<10?"0":"")+o.getMinutes()+"</sup>",q=new Date(o);if(m[f]){if(n="book-calendar-cell-active book-calendar-cell-active-"+this.el,q.setDate(q.getDate()+1),o.getMonth()!=q.getMonth()&&(n+=" book-calendar-cell-last"),this.selectedDate){new Date(this.selectedDate);o.getFullYear()==this.selectedDate.getFullYear()&&o.getMonth()==this.selectedDate.getMonth()&&o.getDate()==this.selectedDate.getDate()&&o.getHours()==this.selectedDate.getHours()&&o.getMinutes()==this.selectedDate.getMinutes()&&(n+=" book-calendar-cell-active-selected")}}else p="&nbsp;",n="book-calendar-cell-disabled";i+='<td style="width: '+this.cellPercentsWidth+'%" data-date="'+o+'" class="book-calendar-cell '+n+'"> '+p+" </td>"}i+="</tr>"}a.dataContainer.innerHTML=i,this.addListeners()}else console.log("Error. Key elements not found!");a.calendarWrapper.style.width=a.container.offsetWidth-40+"px";var r=(this.step,new Date(this.minDate)),s=new Date(this.startDate);s.getTime()>r.getTime()?this.prevDisabled(!1):this.prevDisabled(!1),this.afterDraw(function(){})},this.init()};